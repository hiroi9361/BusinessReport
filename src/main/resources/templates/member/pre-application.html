<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" xmlns="http://www.w3.org/1999/html"
      layout:decorate="~{layout/layout}">
<head>
    <meta charset="UTF-8" th:remove="tag">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>

<div layout:fragment="content">
    <div class="container mt-3">
        <h1 class="mb-4 text-center">事前申請</h1>
        <!--        <form th:action="@{/manager/createEmployee}" th:object="${userCreateInput}" th:method="post" enctype="multipart/form-data" onsubmit="return validateForm()">-->
        <form th:action="@{/manager/createEmployee}" th:method="post" enctype="multipart/form-data" onsubmit="return validateForm()">
            <!-- 社員番号 -->
            <div class="mb-3">
                <label for="employeeCode" class="form-label">社員番号：<span class="text-danger">※</span></label>
                <input type="text" id="employeeCode" th:field="*{userCreateInput.employeeCode}" class="form-control" pattern="[0-9]{1,5}" title="5桁以下の数字を入力してください">

                <!--            <input type="text" id="employeeCode" th:field="*{employeeCode}" class="form-control">-->
                <div th:if="${EmployeeCodeError != null}" class="text-danger mt-1" th:text="${EmployeeCodeError}"></div>
            </div>

            <!-- 名前 -->
            <div class="mb-3">
                <label for="name" class="form-label">名前：<span class="text-danger">※</span></label>
                <!--                <input type="text" id="name" th:field="*{name}" class="form-control" pattern="[A-Za-zぁ-んァ-ン一-龯]+" title="アルファベット、ひらがな、漢字のみが許可されています">-->
                <input type="text" id="name" th:field="${userCreateInput.name}" class="form-control" pattern="[A-Za-zぁ-んァ-ン一-龯]+" title="アルファベット、ひらがな、漢字のみが許可されています">
            </div>

            <div class="form-group mb-3">
                <label>連絡をしてきた人の名前：</label>
                <select th:field="${assignmentCreateInput.employeeCode}" class="form-select">
                    <option th:each="user : ${users}" th:text="${user.name}" name="employeeCode" th:value="${user.employeeCode}"></option>
                </select>
            </div>

            <div class="mb-3">
                <label for="date">連絡を受けた日付：</label>
                <input type="date" id="date" name="今日の日付" value="" />
            </div>
            <div class="mb-3">
                <label for="time">連絡を受けた時間：</label>
                <input type="time" id="time" name="予定の時刻" value="" />
            </div>

            <div class="mb-3">
                <label for="date">対象日時：</label>
                <input type="date" id="date" name="今日の日付" value="" />
            </div>

            <div class="form-group">
                <p>勤怠内容：</p>
                <input type="radio" th:value="1" th:name="1" required checked>遅刻</input>
                <input type="radio" th:value="2" th:name="2" required>欠勤</input>
                <input type="radio" th:value="3" th:name="3" required>早退</input>
                <input type="radio" th:value="4" th:name="4" required>外出</input>
                <input type="radio" th:value="5" th:name="5" required>振替休日</input>
                <input type="radio" th:value="6" th:name="6" required>休日出勤</input>
                <input type="radio" th:value="7" th:name="7" required>有給休暇</input>
                <input type="radio" th:value="8" th:name="8" required>その他</input>
            </div>

            <div>
                <p></p>
                その他：<input type="text">
                <div style="text-align: right">詳しく説明のこと</div>
            </div>

            <div class="form-group">
                <p>事前事後</p>
                <input type="radio" th:value="1" th:name="11" required checked>をしたい(事前)</input>
                <input type="radio" th:value="2" th:name="12" required>をした(事後)</input>
                <div style="text-align: right">という報告/連絡/相談がありました。事後の場合は状況を確認して気を付けるよう指導してください。</div>

            </div>

            <div>
                事由：<input type="text">
                <p style="text-align: right">詳しく説明のこと</p>
            </div>

            <div>
                その他連絡事項：<input type="text">
                <p style="text-align: right">その他気が付いたことを記入</p>
            </div>
            <!-- 登録ボタン -->
            <div class="mb-3">
                <button type="submit" class="w-100 btn btn-lg btn-success">登録</button>
            </div>

        </form>
        <div clasS="button-box">
            <a th:href="@{/manager/employeeList}">ユーザー一覧に戻る</a>
        </div>

    </div>
</div>
<style layout:fragment="style">
    @media (max-width: 768px) {
        h1 {
            font-size: 1.3em;
        }
    }
</style>
<script layout:fragment="script" th:inline="javascript">
    <!--test---------------------------------------------------------->
    /*<![CDATA[*/
    const elem = document.getElementById("add-team");
    const teamField = document.getElementById("team-field");
    var teamList = /*[[${teamList}]]*/ [];
    let assignmentIndex = /*[[${assignmentCreateInput.assignments.size()}]]*/;

    elem.onclick = function () {
        const row = document.createElement("div");
        row.className = "d-flex";

        const teamSelect = document.createElement("select");
        teamSelect.className = "form-select";
        teamSelect.innerHTML += '<option value="0">選択してください</option>';
        teamList.forEach(function (team) {
            const option = document.createElement("option");
            option.value = team.teamId;
            option.text = team.name;
            teamSelect.appendChild(option);
        });

        const managerSelect = document.createElement("select");
        managerSelect.className = "form-select";
        managerSelect.innerHTML += '<option value="false">選択してください</option>';
        managerSelect.innerHTML += '<option value="false" name="isManager">Member</option>';
        managerSelect.innerHTML += '<option value="true" name="isManager">Manager</option>';

        const removeButton = document.createElement("button");
        removeButton.type = "button";
        removeButton.className = "btn btn-danger";
        removeButton.onclick = function () {
            removeTeam(this);
        };
        removeButton.innerHTML = "削除";

        row.appendChild(teamSelect);
        row.appendChild(managerSelect);
        row.appendChild(removeButton);

        teamField.appendChild(row);

        assignmentIndex++;
    };

    function removeTeam(button) {
        const row = button.parentElement;
        row.remove();
        assignmentIndex--;  // 削除されたらインデックスを減らす
    }
    /*]]>*/
    <!--test---------------------------------------------------------->
    function validateForm() {
        var employeeCode = document.getElementById('employeeCode').value;
        var name = document.getElementById('name').value;
        var password = document.getElementById('password').value;

        if (employeeCode.trim() === '' || name.trim() === '' || password.trim() === '') {
            alert('全てのフィールドを記入してください');
            return false;
        }
        return true;
    };

    <!--    const elem = document.getElementById("add-team");-->
    <!--    const teamField = document.getElementById("team-field");-->
    <!--    let teamIndex = /*[[${assignmentCreateInput.assignments.size()}]]*/;-->

    <!--    elem.onclick = function() {-->
    <!--    console.log("test");-->
    <!--        const node = document.createElement("div");-->
    <!--        node.setAttribute("class", "row");-->
    <!--        node.innerHTML += `-->
    <!--        `;-->

    <!--        teamField.appendChild(node);-->
    <!--        teamIndex++;-->
    <!--    };-->

    <!--    function removeTask(button) {-->
    <!--        button.parentNode.parentNode.remove();-->
    <!--    }-->

</script>
</body>

</html>